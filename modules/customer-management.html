<!DOCTYPE html>
<html>
<head>
    <title>Customer Management Pro - Majelani Accounting</title>
    <meta charset="UTF-8">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #0a0a0a 0%, #1a1a2e 50%, #16213e 100%);
            color: white;
            min-height: 100vh;
        }

        .header {
            background: linear-gradient(90deg, rgba(0, 255, 255, 0.1), rgba(0, 128, 255, 0.1));
            border-bottom: 2px solid #00ffff;
            padding: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 15px;
        }

        .header h1 {
            color: #00ffff;
            text-shadow: 0 0 10px rgba(0, 255, 255, 0.5);
        }

        .header-actions {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .back-btn, .export-btn, .import-btn {
            background: linear-gradient(45deg, #00ffff, #0080ff);
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            color: #000;
            cursor: pointer;
            font-weight: bold;
            text-decoration: none;
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 14px;
        }

        .export-btn { background: linear-gradient(45deg, #00ff88, #00cc66); }
        .import-btn { background: linear-gradient(45deg, #ffaa00, #ff8800); }

        .container {
            padding: 20px;
            max-width: 1600px;
            margin: 0 auto;
        }

        .tabs {
            display: flex;
            gap: 5px;
            margin-bottom: 30px;
            border-bottom: 2px solid rgba(0, 255, 255, 0.2);
        }

        .tab {
            padding: 12px 20px;
            background: rgba(0, 0, 0, 0.3);
            border: none;
            color: #888;
            cursor: pointer;
            border-radius: 10px 10px 0 0;
            transition: all 0.3s ease;
        }

        .tab.active {
            background: linear-gradient(135deg, rgba(0, 255, 255, 0.2), rgba(0, 128, 255, 0.2));
            color: #00ffff;
            border-bottom: 2px solid #00ffff;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .controls {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            flex-wrap: wrap;
            gap: 15px;
        }

        .search-filters {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
        }

        .search-box, .filter-select {
            background: rgba(0, 0, 0, 0.5);
            border: 2px solid rgba(0, 255, 255, 0.3);
            border-radius: 8px;
            padding: 10px 12px;
            color: white;
            font-size: 14px;
        }

        .search-box { width: 250px; }
        .filter-select { width: 150px; }

        .search-box:focus, .filter-select:focus {
            outline: none;
            border-color: #00ffff;
            box-shadow: 0 0 10px rgba(0, 255, 255, 0.3);
        }

        /* Remove number input arrows for all number inputs */
        input[type="number"]::-webkit-outer-spin-button,
        input[type="number"]::-webkit-inner-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }

        input[type="number"] {
            -moz-appearance: textfield;
        }

        .action-buttons {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .add-btn, .bulk-btn {
            background: linear-gradient(45deg, #00ff88, #00ffff);
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            color: #000;
            cursor: pointer;
            font-weight: bold;
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 14px;
        }

        .bulk-btn { background: linear-gradient(45deg, #ff6b6b, #ee5a52); color: white; }

        .customers-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(380px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .customer-card {
            background: linear-gradient(135deg, rgba(0, 255, 255, 0.1), rgba(0, 128, 255, 0.1));
            border: 1px solid rgba(0, 255, 255, 0.3);
            border-radius: 15px;
            padding: 20px;
            transition: all 0.3s ease;
            position: relative;
        }

        .customer-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(0, 255, 255, 0.2);
        }

        .customer-card.selected {
            border-color: #00ff88;
            box-shadow: 0 0 20px rgba(0, 255, 136, 0.3);
        }

        .card-checkbox {
            position: absolute;
            top: 15px;
            right: 15px;
        }

        .customer-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .customer-name {
            color: #00ffff;
            font-size: 18px;
            font-weight: bold;
        }

        .customer-status {
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: bold;
        }

        .status-active { background: rgba(0, 255, 0, 0.2); color: #00ff00; }
        .status-inactive { background: rgba(255, 0, 0, 0.2); color: #ff4444; }
        .status-vip { background: rgba(255, 215, 0, 0.2); color: #ffd700; }

        .customer-info {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 8px;
            margin-bottom: 15px;
        }

        .info-item {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 13px;
            color: #b0b0b0;
        }

        .info-icon {
            color: #00ffff;
            width: 14px;
        }

        .customer-financial {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 8px;
            padding: 12px;
            margin-bottom: 15px;
        }

        .financial-item {
            display: flex;
            justify-content: space-between;
            margin-bottom: 5px;
            font-size: 13px;
        }

        .financial-label { color: #888; }
        .financial-value { color: #00ffff; font-weight: bold; }
        .financial-value.negative { color: #ff4444; }
        .financial-value.positive { color: #00ff88; }

        .customer-actions {
            display: flex;
            gap: 8px;
            justify-content: flex-end;
            flex-wrap: wrap;
        }

        .action-btn {
            padding: 6px 10px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 11px;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .edit-btn { background: linear-gradient(45deg, #ffaa00, #ff8800); color: #000; }
        .delete-btn { background: linear-gradient(45deg, #ff4444, #cc0000); color: white; }
        .view-btn { background: linear-gradient(45deg, #00ffff, #0080ff); color: #000; }
        .email-btn { background: linear-gradient(45deg, #4CAF50, #45a049); color: white; }
        .files-btn { background: linear-gradient(45deg, #9C27B0, #7B1FA2); color: white; }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            z-index: 1000;
            overflow-y: auto;
        }

        .modal-content {
            position: relative;
            background: linear-gradient(135deg, #1a1a2e, #16213e);
            border: 2px solid #00ffff;
            border-radius: 15px;
            padding: 30px;
            width: 90%;
            max-width: 800px;
            margin: 50px auto;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
        }

        .modal-title {
            color: #00ffff;
            font-size: 22px;
        }

        .close-btn {
            background: none;
            border: none;
            color: #ff4444;
            font-size: 28px;
            cursor: pointer;
        }

        .form-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group.full-width {
            grid-column: 1 / -1;
        }

        .form-label {
            display: block;
            color: #00ffff;
            margin-bottom: 8px;
            font-weight: bold;
            font-size: 14px;
        }

        .form-input, .form-select, .form-textarea {
            width: 100%;
            background: rgba(0, 0, 0, 0.5);
            border: 2px solid rgba(0, 255, 255, 0.3);
            border-radius: 8px;
            padding: 12px;
            color: white;
            font-size: 14px;
        }

        .form-input:focus, .form-select:focus, .form-textarea:focus {
            outline: none;
            border-color: #00ffff;
            box-shadow: 0 0 10px rgba(0, 255, 255, 0.3);
        }

        /* Remove number input arrows */
        .form-input[type="number"]::-webkit-outer-spin-button,
        .form-input[type="number"]::-webkit-inner-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }

        .form-input[type="number"] {
            -moz-appearance: textfield;
        }

        .form-textarea {
            resize: vertical;
            min-height: 80px;
        }

        .file-upload {
            border: 2px dashed rgba(0, 255, 255, 0.3);
            border-radius: 8px;
            padding: 20px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .file-upload:hover {
            border-color: #00ffff;
            background: rgba(0, 255, 255, 0.05);
        }

        .file-list {
            margin-top: 15px;
        }

        .file-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 12px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 5px;
            margin-bottom: 5px;
        }

        .form-actions {
            display: flex;
            gap: 15px;
            justify-content: flex-end;
            margin-top: 30px;
        }

        .save-btn {
            background: linear-gradient(45deg, #00ff88, #00ffff);
            border: none;
            padding: 12px 25px;
            border-radius: 8px;
            color: #000;
            cursor: pointer;
            font-weight: bold;
        }

        .cancel-btn {
            background: linear-gradient(45deg, #666, #444);
            border: none;
            padding: 12px 25px;
            border-radius: 8px;
            color: white;
            cursor: pointer;
            font-weight: bold;
        }

        .analytics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .analytics-card {
            background: linear-gradient(135deg, rgba(0, 255, 255, 0.1), rgba(0, 128, 255, 0.1));
            border: 1px solid rgba(0, 255, 255, 0.3);
            border-radius: 15px;
            padding: 25px;
        }

        .analytics-title {
            color: #00ffff;
            font-size: 18px;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .stat-number {
            font-size: 32px;
            font-weight: bold;
            color: #00ff88;
            margin-bottom: 10px;
        }

        .stat-label {
            color: #888;
            font-size: 14px;
        }

        .chart-container {
            position: relative;
            height: 300px;
            margin-top: 20px;
        }

        .communication-log {
            max-height: 400px;
            overflow-y: auto;
        }

        .comm-item {
            background: rgba(0, 0, 0, 0.3);
            border-left: 3px solid #00ffff;
            padding: 15px;
            margin-bottom: 10px;
            border-radius: 0 8px 8px 0;
        }

        .comm-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }

        .comm-type {
            background: rgba(0, 255, 255, 0.2);
            color: #00ffff;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 11px;
        }

        .comm-date {
            color: #888;
            font-size: 12px;
        }

        .reminder-item {
            background: rgba(255, 165, 0, 0.1);
            border: 1px solid rgba(255, 165, 0, 0.3);
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 10px;
        }

        .reminder-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }

        .reminder-title {
            color: #ffaa00;
            font-weight: bold;
        }

        .reminder-due {
            color: #ff6b6b;
            font-size: 12px;
        }

        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: #666;
        }

        .empty-icon {
            font-size: 64px;
            color: #333;
            margin-bottom: 20px;
        }

        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px 20px;
            border-radius: 8px;
            color: white;
            font-weight: bold;
            z-index: 2000;
            transform: translateX(400px);
            transition: transform 0.3s ease;
        }

        .notification.show {
            transform: translateX(0);
        }

        .notification.success { background: linear-gradient(45deg, #00ff88, #00cc66); }
        .notification.error { background: linear-gradient(45deg, #ff4444, #cc0000); }
        .notification.info { background: linear-gradient(45deg, #00ffff, #0080ff); }

        .custom-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            z-index: 2000;
            animation: fadeIn 0.3s ease;
        }

        .custom-modal-content {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: linear-gradient(135deg, #1a1a2e, #16213e);
            border: 2px solid #00ffff;
            border-radius: 20px;
            padding: 30px;
            width: 90%;
            max-width: 600px;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: 0 20px 60px rgba(0, 255, 255, 0.3);
            animation: slideIn 0.3s ease;
        }

        .custom-modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 2px solid rgba(0, 255, 255, 0.2);
        }

        .custom-modal-title {
            color: #00ffff;
            font-size: 24px;
            font-weight: bold;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .custom-modal-close {
            background: linear-gradient(45deg, #ff4444, #cc0000);
            border: none;
            color: white;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
        }

        .custom-modal-close:hover {
            transform: scale(1.1);
            box-shadow: 0 0 20px rgba(255, 68, 68, 0.5);
        }

        .custom-modal-body {
            color: #e0e0e0;
            line-height: 1.6;
        }

        .customer-detail-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 25px;
        }

        .detail-item {
            background: rgba(0, 255, 255, 0.05);
            border: 1px solid rgba(0, 255, 255, 0.2);
            border-radius: 10px;
            padding: 15px;
        }

        .detail-label {
            color: #00ffff;
            font-size: 12px;
            font-weight: bold;
            text-transform: uppercase;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .detail-value {
            color: #ffffff;
            font-size: 16px;
            font-weight: 500;
        }

        .detail-value.large {
            font-size: 20px;
            font-weight: bold;
        }

        .detail-value.positive {
            color: #00ff88;
        }

        .detail-value.negative {
            color: #ff4444;
        }

        .files-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }

        .file-card {
            background: rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(0, 255, 255, 0.3);
            border-radius: 10px;
            padding: 15px;
            text-align: center;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .file-card:hover {
            border-color: #00ffff;
            background: rgba(0, 255, 255, 0.1);
            transform: translateY(-2px);
        }

        .file-icon {
            font-size: 32px;
            color: #00ffff;
            margin-bottom: 10px;
        }

        .file-name {
            color: #ffffff;
            font-size: 14px;
            font-weight: bold;
            margin-bottom: 5px;
            word-break: break-word;
        }

        .file-size {
            color: #888;
            font-size: 12px;
        }

        .email-compose {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 15px;
            padding: 25px;
            margin-top: 20px;
        }

        .compose-field {
            margin-bottom: 20px;
        }

        .compose-label {
            color: #00ffff;
            font-size: 14px;
            font-weight: bold;
            margin-bottom: 8px;
            display: block;
        }

        .compose-input, .compose-textarea {
            width: 100%;
            background: rgba(0, 0, 0, 0.5);
            border: 2px solid rgba(0, 255, 255, 0.3);
            border-radius: 8px;
            padding: 12px;
            color: white;
            font-size: 14px;
        }

        .compose-input:focus, .compose-textarea:focus {
            outline: none;
            border-color: #00ffff;
            box-shadow: 0 0 15px rgba(0, 255, 255, 0.3);
        }

        .compose-textarea {
            min-height: 120px;
            resize: vertical;
        }

        .compose-actions {
            display: flex;
            gap: 15px;
            justify-content: flex-end;
            margin-top: 20px;
        }

        .send-btn {
            background: linear-gradient(45deg, #00ff88, #00ffff);
            border: none;
            padding: 12px 25px;
            border-radius: 8px;
            color: #000;
            cursor: pointer;
            font-weight: bold;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: all 0.3s ease;
        }

        .send-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(0, 255, 136, 0.4);
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        @keyframes slideIn {
            from { transform: translate(-50%, -60%); opacity: 0; }
            to { transform: translate(-50%, -50%); opacity: 1; }
        }

        @media (max-width: 768px) {
            .customer-detail-grid {
                grid-template-columns: 1fr;
            }
            
            .files-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="header">
        <h1><i class="fas fa-users"></i> Customer Management Pro</h1>
        <div class="header-actions">
            <button class="export-btn" onclick="exportData()">
                <i class="fas fa-download"></i> Export
            </button>
            <button class="import-btn" onclick="document.getElementById('importFile').click()">
                <i class="fas fa-upload"></i> Import
            </button>
            <a href="../dashboard.html" class="back-btn">
                <i class="fas fa-arrow-left"></i> Dashboard
            </a>
        </div>
    </div>

    <input type="file" id="importFile" accept=".csv,.xlsx" style="display: none;" onchange="importData(this)">

    <div class="container">
        <div class="tabs">
            <button class="tab active" onclick="switchTab('customers')">
                <i class="fas fa-users"></i> Customers
            </button>
            <button class="tab" onclick="switchTab('analytics')">
                <i class="fas fa-chart-bar"></i> Analytics
            </button>
            <button class="tab" onclick="switchTab('communications')">
                <i class="fas fa-comments"></i> Communications
            </button>
            <button class="tab" onclick="switchTab('reminders')">
                <i class="fas fa-bell"></i> Reminders
            </button>
        </div>

        <!-- Customers Tab -->
        <div class="tab-content active" id="customers-tab">
            <div class="controls">
                <div class="search-filters">
                    <input type="text" class="search-box" id="searchBox" placeholder="Search customers...">
                    <select class="filter-select" id="statusFilter">
                        <option value="">All Status</option>
                        <option value="active">Active</option>
                        <option value="inactive">Inactive</option>
                        <option value="vip">VIP</option>
                    </select>
                    <select class="filter-select" id="segmentFilter">
                        <option value="">All Segments</option>
                        <option value="high-value">High Value</option>
                        <option value="regular">Regular</option>
                        <option value="new">New</option>
                    </select>
                </div>
                <div class="action-buttons">
                    <button class="bulk-btn" onclick="toggleBulkMode()" id="bulkBtn">
                        <i class="fas fa-check-square"></i> Bulk Actions
                    </button>
                    <button class="add-btn" onclick="openAddModal()">
                        <i class="fas fa-plus"></i> Add Customer
                    </button>
                </div>
            </div>

            <div class="customers-grid" id="customersGrid">
                <!-- Customers will be loaded here -->
            </div>

            <div class="empty-state" id="emptyState" style="display: none;">
                <div class="empty-icon">
                    <i class="fas fa-users"></i>
                </div>
                <h3>No customers found</h3>
                <p>Add your first customer to get started</p>
            </div>
        </div>

        <!-- Analytics Tab -->
        <div class="tab-content" id="analytics-tab">
            <div class="analytics-grid">
                <div class="analytics-card">
                    <div class="analytics-title">
                        <i class="fas fa-users"></i> Total Customers
                    </div>
                    <div class="stat-number" id="totalCustomers">0</div>
                    <div class="stat-label">Active customers in system</div>
                </div>
                <div class="analytics-card">
                    <div class="analytics-title">
                        <i class="fas fa-dollar-sign"></i> Total Revenue
                    </div>
                    <div class="stat-number" id="totalRevenue">$0</div>
                    <div class="stat-label">From all customers</div>
                </div>
                <div class="analytics-card">
                    <div class="analytics-title">
                        <i class="fas fa-star"></i> VIP Customers
                    </div>
                    <div class="stat-number" id="vipCustomers">0</div>
                    <div class="stat-label">High-value customers</div>
                </div>
                <div class="analytics-card">
                    <div class="analytics-title">
                        <i class="fas fa-exclamation-triangle"></i> Overdue
                    </div>
                    <div class="stat-number" id="overdueCustomers">0</div>
                    <div class="stat-label">Customers with overdue payments</div>
                </div>
            </div>
            
            <div class="analytics-card">
                <div class="analytics-title">
                    <i class="fas fa-chart-line"></i> Customer Growth
                </div>
                <div class="chart-container">
                    <canvas id="growthChart"></canvas>
                </div>
            </div>
        </div>

        <!-- Communications Tab -->
        <div class="tab-content" id="communications-tab">
            <div class="controls">
                <button class="add-btn" onclick="openCommModal()">
                    <i class="fas fa-plus"></i> New Communication
                </button>
            </div>
            <div class="communication-log" id="communicationLog">
                <!-- Communications will be loaded here -->
            </div>
        </div>

        <!-- Reminders Tab -->
        <div class="tab-content" id="reminders-tab">
            <div class="controls">
                <button class="add-btn" onclick="openReminderModal()">
                    <i class="fas fa-plus"></i> New Reminder
                </button>
            </div>
            <div id="remindersList">
                <!-- Reminders will be loaded here -->
            </div>
        </div>
    </div>

    <!-- Customer Modal -->
    <div class="modal" id="customerModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title" id="modalTitle">Add Customer</h3>
                <button class="close-btn" onclick="closeModal('customerModal')">&times;</button>
            </div>
            <form id="customerForm">
                <div class="form-grid">
                    <div class="form-group">
                        <label class="form-label">Customer Name *</label>
                        <input type="text" class="form-input" id="customerName" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Email</label>
                        <input type="email" class="form-input" id="customerEmail">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Phone</label>
                        <input type="tel" class="form-input" id="customerPhone">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Company</label>
                        <input type="text" class="form-input" id="customerCompany">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Status</label>
                        <select class="form-select" id="customerStatus">
                            <option value="active">Active</option>
                            <option value="inactive">Inactive</option>
                            <option value="vip">VIP</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Credit Limit</label>
                        <input type="number" class="form-input" id="creditLimit" step="0.01">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Payment Terms (Days)</label>
                        <input type="number" class="form-input" id="paymentTerms" value="30">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Tax ID</label>
                        <input type="text" class="form-input" id="taxId">
                    </div>
                    <div class="form-group full-width">
                        <label class="form-label">Address</label>
                        <textarea class="form-textarea" id="customerAddress"></textarea>
                    </div>
                    <div class="form-group full-width">
                        <label class="form-label">Notes</label>
                        <textarea class="form-textarea" id="customerNotes"></textarea>
                    </div>
                    <div class="form-group full-width">
                        <label class="form-label">Upload Files</label>
                        <div class="file-upload" onclick="document.getElementById('customerFiles').click()">
                            <i class="fas fa-cloud-upload-alt"></i>
                            <p>Click to upload files or drag and drop</p>
                        </div>
                        <input type="file" id="customerFiles" multiple style="display: none;" onchange="handleFileUpload(this)">
                        <div class="file-list" id="fileList"></div>
                    </div>
                </div>
                <div class="form-actions">
                    <button type="button" class="cancel-btn" onclick="closeModal('customerModal')">Cancel</button>
                    <button type="submit" class="save-btn">Save Customer</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Communication Modal -->
    <div class="modal" id="commModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">New Communication</h3>
                <button class="close-btn" onclick="closeModal('commModal')">&times;</button>
            </div>
            <form id="commForm">
                <div class="form-group">
                    <label class="form-label">Customer</label>
                    <select class="form-select" id="commCustomer" required>
                        <option value="">Select Customer</option>
                    </select>
                </div>
                <div class="form-group">
                    <label class="form-label">Type</label>
                    <select class="form-select" id="commType" required>
                        <option value="email">Email</option>
                        <option value="phone">Phone Call</option>
                        <option value="meeting">Meeting</option>
                        <option value="sms">SMS</option>
                    </select>
                </div>
                <div class="form-group">
                    <label class="form-label">Subject</label>
                    <input type="text" class="form-input" id="commSubject" required>
                </div>
                <div class="form-group">
                    <label class="form-label">Message</label>
                    <textarea class="form-textarea" id="commMessage" required></textarea>
                </div>
                <div class="form-actions">
                    <button type="button" class="cancel-btn" onclick="closeModal('commModal')">Cancel</button>
                    <button type="submit" class="save-btn">Send & Log</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Reminder Modal -->
    <div class="modal" id="reminderModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">New Reminder</h3>
                <button class="close-btn" onclick="closeModal('reminderModal')">&times;</button>
            </div>
            <form id="reminderForm">
                <div class="form-group">
                    <label class="form-label">Customer</label>
                    <select class="form-select" id="reminderCustomer" required>
                        <option value="">Select Customer</option>
                    </select>
                </div>
                <div class="form-group">
                    <label class="form-label">Type</label>
                    <select class="form-select" id="reminderType" required>
                        <option value="follow-up">Follow-up</option>
                        <option value="payment">Payment Due</option>
                        <option value="birthday">Birthday</option>
                        <option value="contract">Contract Renewal</option>
                        <option value="custom">Custom</option>
                    </select>
                </div>
                <div class="form-group">
                    <label class="form-label">Title</label>
                    <input type="text" class="form-input" id="reminderTitle" required>
                </div>
                <div class="form-group">
                    <label class="form-label">Due Date</label>
                    <input type="datetime-local" class="form-input" id="reminderDate" required>
                </div>
                <div class="form-group">
                    <label class="form-label">Description</label>
                    <textarea class="form-textarea" id="reminderDescription"></textarea>
                </div>
                <div class="form-actions">
                    <button type="button" class="cancel-btn" onclick="closeModal('reminderModal')">Cancel</button>
                    <button type="submit" class="save-btn">Create Reminder</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Custom Customer Detail Modal -->
    <div class="custom-modal" id="customerDetailModal">
        <div class="custom-modal-content">
            <div class="custom-modal-header">
                <h3 class="custom-modal-title" id="detailModalTitle">
                    <i class="fas fa-user"></i> Customer Details
                </h3>
                <button class="custom-modal-close" onclick="closeCustomModal('customerDetailModal')">&times;</button>
            </div>
            <div class="custom-modal-body" id="customerDetailBody">
                <!-- Customer details will be loaded here -->
            </div>
        </div>
    </div>

    <!-- Custom Files Modal -->
    <div class="custom-modal" id="filesModal">
        <div class="custom-modal-content">
            <div class="custom-modal-header">
                <h3 class="custom-modal-title">
                    <i class="fas fa-folder-open"></i> Customer Files
                </h3>
                <button class="custom-modal-close" onclick="closeCustomModal('filesModal')">&times;</button>
            </div>
            <div class="custom-modal-body" id="filesModalBody">
                <!-- Files will be loaded here -->
            </div>
        </div>
    </div>

    <!-- Custom Email Modal -->
    <div class="custom-modal" id="emailModal">
        <div class="custom-modal-content">
            <div class="custom-modal-header">
                <h3 class="custom-modal-title">
                    <i class="fas fa-envelope"></i> Send Email
                </h3>
                <button class="custom-modal-close" onclick="closeCustomModal('emailModal')">&times;</button>
            </div>
            <div class="custom-modal-body">
                <div class="email-compose">
                    <div class="compose-field">
                        <label class="compose-label">To:</label>
                        <input type="email" class="compose-input" id="emailTo" readonly>
                    </div>
                    <div class="compose-field">
                        <label class="compose-label">Subject:</label>
                        <input type="text" class="compose-input" id="emailSubject" placeholder="Enter email subject...">
                    </div>
                    <div class="compose-field">
                        <label class="compose-label">Message:</label>
                        <textarea class="compose-textarea" id="emailMessage" placeholder="Type your message here..."></textarea>
                    </div>
                    <div class="compose-actions">
                        <button type="button" class="cancel-btn" onclick="closeCustomModal('emailModal')">Cancel</button>
                        <button type="button" class="send-btn" onclick="sendEmail()">
                            <i class="fas fa-paper-plane"></i> Send Email
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Data Storage
        let customers = JSON.parse(localStorage.getItem('customers')) || [
            {
                id: 1,
                name: "Ahmad Rezaei",
                email: "ahmad.rezaei@company.com",
                phone: "+98-912-345-6789",
                company: "Rezaei Trading Company",
                address: "Tehran, Valiasr Street, No. 123",
                notes: "VIP Customer - Always pays on time",
                status: "vip",
                creditLimit: 50000,
                paymentTerms: 15,
                taxId: "1234567890",
                balance: 12500.75,
                creditUsed: 8200.50,
                createdAt: "2024-01-15T10:30:00.000Z"
            },
            {
                id: 2,
                name: "Fateme Mohammadi",
                email: "fateme.mohammadi@gmail.com",
                phone: "+98-998-765-4321",
                company: "Modern Advertising Agency",
                address: "Isfahan, Chaharbagh Street, Pars Commercial Complex",
                notes: "New customer - Needs more follow-up",
                status: "active",
                creditLimit: 25000,
                paymentTerms: 30,
                taxId: "0987654321",
                balance: -2300.25,
                creditUsed: 15600.00,
                createdAt: "2024-02-20T14:15:00.000Z"
            },
            {
                id: 3,
                name: "Ali Karimi",
                email: "ali.karimi@techco.ir",
                phone: "+98-911-223-3445",
                company: "Advanced IT Solutions",
                address: "Shiraz, Zand Boulevard, Sky Tower, Floor 12",
                notes: "IT Specialist - Large projects",
                status: "active",
                creditLimit: 75000,
                paymentTerms: 45,
                taxId: "1122334455",
                balance: 45200.00,
                creditUsed: 32100.75,
                createdAt: "2023-11-10T09:45:00.000Z"
            },
            {
                id: 4,
                name: "Maryam Ahmadi",
                email: "maryam.ahmadi@fashion.com",
                phone: "+98-933-445-5667",
                company: "Maryam Fashion Boutique",
                address: "Mashhad, Imam Reza Street, Modern Passage, Unit 45",
                notes: "Seasonal - High orders during holidays",
                status: "inactive",
                creditLimit: 30000,
                paymentTerms: 30,
                taxId: "5544332211",
                balance: 0,
                creditUsed: 0,
                createdAt: "2023-08-05T16:20:00.000Z"
            },
            {
                id: 5,
                name: "Hassan Mousavi",
                email: "hassan.mousavi@construction.ir",
                phone: "+98-955-667-7889",
                company: "Mousavi Construction Company",
                address: "Karaj, Industrial Park, Industry Street, No. 67",
                notes: "Major contractor - Infrastructure projects",
                status: "vip",
                creditLimit: 100000,
                paymentTerms: 60,
                taxId: "9988776655",
                balance: 78900.50,
                creditUsed: 45300.25,
                createdAt: "2023-05-12T11:10:00.000Z"
            },
            {
                id: 6,
                name: "Zahra Sadeghi",
                email: "zahra.sadeghi@restaurant.com",
                phone: "+98-977-889-9001",
                company: "Mountain Traditional Restaurant",
                address: "Tabriz, Shahriyar Street, Mountain Restaurant",
                notes: "Popular restaurant - Regular orders",
                status: "active",
                creditLimit: 20000,
                paymentTerms: 20,
                taxId: "6677889900",
                balance: 5600.75,
                creditUsed: 12400.00,
                createdAt: "2024-03-01T13:30:00.000Z"
            },
            {
                id: 7,
                name: "Mohammad Nouri",
                email: "mohammad.nouri@pharmacy.ir",
                phone: "+98-944-556-6778",
                company: "Central Nouri Pharmacy",
                address: "Kerman, Shohada Square, Central Pharmacy",
                notes: "Pharmacy - Needs fast delivery",
                status: "active",
                creditLimit: 40000,
                paymentTerms: 25,
                taxId: "3344556677",
                balance: 18750.25,
                creditUsed: 22100.50,
                createdAt: "2023-12-18T08:45:00.000Z"
            },
            {
                id: 8,
                name: "Sara Hosseini",
                email: "sara.hosseini@beauty.com",
                phone: "+98-922-334-4556",
                company: "Queen Beauty Salon",
                address: "Ahvaz, Kianpars Street, Queen Beauty Salon",
                notes: "Family business - Loyal customer",
                status: "active",
                creditLimit: 15000,
                paymentTerms: 30,
                taxId: "7788990011",
                balance: 3200.00,
                creditUsed: 8900.75,
                createdAt: "2024-01-28T15:20:00.000Z"
            }
        ];
        let communications = JSON.parse(localStorage.getItem('communications')) || [
            {
                id: 1,
                customerId: 1,
                customerName: "Ahmad Rezaei",
                type: "email",
                subject: "New Order Confirmation",
                message: "Your order has been successfully registered and is being prepared.",
                date: "2024-12-15T10:30:00.000Z"
            },
            {
                id: 2,
                customerId: 2,
                customerName: "Fateme Mohammadi",
                type: "phone",
                subject: "Payment Follow-up",
                message: "Phone call to follow up on payment status for invoice #1234",
                date: "2024-12-14T14:15:00.000Z"
            },
            {
                id: 3,
                customerId: 5,
                customerName: "Hassan Mousavi",
                type: "meeting",
                subject: "New Project Review Meeting",
                message: "In-person meeting to review details of new construction project",
                date: "2024-12-13T09:00:00.000Z"
            }
        ];
        let reminders = JSON.parse(localStorage.getItem('reminders')) || [
            {
                id: 1,
                customerId: 2,
                customerName: "Fateme Mohammadi",
                type: "payment",
                title: "Overdue Payment Follow-up",
                description: "Follow up on payment for invoice #1234 which is past due date",
                date: "2024-12-20T10:00:00.000Z"
            },
            {
                id: 2,
                customerId: 6,
                customerName: "Zahra Sadeghi",
                type: "follow-up",
                title: "Order Follow-up Call",
                description: "Call to check satisfaction with services and potential new orders",
                date: "2024-12-18T15:30:00.000Z"
            },
            {
                id: 3,
                customerId: 1,
                customerName: "Ahmad Rezaei",
                type: "birthday",
                title: "Birthday Congratulations",
                description: "Send birthday message and offer special discount",
                date: "2024-12-25T09:00:00.000Z"
            }
        ];
        let customerFiles = JSON.parse(localStorage.getItem('customerFiles')) || {
            1: [
                { name: "Contract_Ahmad_Rezaei.pdf", size: 245760 },
                { name: "ID_Documents.jpg", size: 156432 }
            ],
            3: [
                { name: "IT_Project_Proposal.docx", size: 512000 },
                { name: "Business_License.pdf", size: 189234 }
            ],
            5: [
                { name: "Construction_Contract.pdf", size: 678912 },
                { name: "Project_Blueprint.dwg", size: 1024000 },
                { name: "Building_Permit.pdf", size: 334567 }
            ]
        };
        
        let editingId = null;
        let bulkMode = false;
        let selectedCustomers = new Set();

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            loadCustomers();
            loadAnalytics();
            loadCommunications();
            loadReminders();
            populateCustomerSelects();
            checkReminders();
        });

        // Tab Management
        function switchTab(tabName) {
            document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
            
            event.target.classList.add('active');
            document.getElementById(tabName + '-tab').classList.add('active');
            
            if (tabName === 'analytics') {
                setTimeout(loadAnalytics, 100);
            }
        }

        // Customer Management
        function loadCustomers() {
            const grid = document.getElementById('customersGrid');
            const emptyState = document.getElementById('emptyState');
            
            if (customers.length === 0) {
                grid.style.display = 'none';
                emptyState.style.display = 'block';
                return;
            }
            
            grid.style.display = 'grid';
            emptyState.style.display = 'none';
            
            grid.innerHTML = customers.map(customer => {
                const balance = customer.balance || 0;
                const creditUsed = customer.creditUsed || 0;
                const creditLimit = customer.creditLimit || 0;
                
                return `
                    <div class="customer-card ${selectedCustomers.has(customer.id) ? 'selected' : ''}" data-id="${customer.id}">
                        ${bulkMode ? `<input type="checkbox" class="card-checkbox" ${selectedCustomers.has(customer.id) ? 'checked' : ''} onchange="toggleCustomerSelection(${customer.id})">` : ''}
                        <div class="customer-header">
                            <div class="customer-name">${customer.name}</div>
                            <div class="customer-status status-${customer.status}">${customer.status.toUpperCase()}</div>
                        </div>
                        <div class="customer-info">
                            <div class="info-item">
                                <i class="fas fa-envelope info-icon"></i>
                                <span>${customer.email || 'No email'}</span>
                            </div>
                            <div class="info-item">
                                <i class="fas fa-phone info-icon"></i>
                                <span>${customer.phone || 'No phone'}</span>
                            </div>
                            <div class="info-item">
                                <i class="fas fa-building info-icon"></i>
                                <span>${customer.company || 'No company'}</span>
                            </div>
                            <div class="info-item">
                                <i class="fas fa-calendar info-icon"></i>
                                <span>${new Date(customer.createdAt).toLocaleDateString()}</span>
                            </div>
                        </div>
                        <div class="customer-financial">
                            <div class="financial-item">
                                <span class="financial-label">Balance:</span>
                                <span class="financial-value ${balance >= 0 ? 'positive' : 'negative'}">$${Math.abs(balance).toFixed(2)}</span>
                            </div>
                            <div class="financial-item">
                                <span class="financial-label">Credit Used:</span>
                                <span class="financial-value">$${creditUsed.toFixed(2)} / $${creditLimit.toFixed(2)}</span>
                            </div>
                            <div class="financial-item">
                                <span class="financial-label">Payment Terms:</span>
                                <span class="financial-value">${customer.paymentTerms || 30} days</span>
                            </div>
                        </div>
                        <div class="customer-actions">
                            <button class="action-btn view-btn" onclick="viewCustomer(${customer.id})">
                                <i class="fas fa-eye"></i>
                            </button>
                            <button class="action-btn files-btn" onclick="viewFiles(${customer.id})">
                                <i class="fas fa-folder"></i>
                            </button>
                            <button class="action-btn email-btn" onclick="emailCustomer(${customer.id})">
                                <i class="fas fa-envelope"></i>
                            </button>
                            <button class="action-btn edit-btn" onclick="editCustomer(${customer.id})">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button class="action-btn delete-btn" onclick="deleteCustomer(${customer.id})">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function openAddModal() {
            document.getElementById('modalTitle').textContent = 'Add Customer';
            document.getElementById('customerForm').reset();
            document.getElementById('fileList').innerHTML = '';
            editingId = null;
            document.getElementById('customerModal').style.display = 'block';
        }

        function editCustomer(id) {
            const customer = customers.find(c => c.id === id);
            if (!customer) return;
            
            document.getElementById('modalTitle').textContent = 'Edit Customer';
            document.getElementById('customerName').value = customer.name;
            document.getElementById('customerEmail').value = customer.email || '';
            document.getElementById('customerPhone').value = customer.phone || '';
            document.getElementById('customerCompany').value = customer.company || '';
            document.getElementById('customerAddress').value = customer.address || '';
            document.getElementById('customerNotes').value = customer.notes || '';
            document.getElementById('customerStatus').value = customer.status;
            document.getElementById('creditLimit').value = customer.creditLimit || '';
            document.getElementById('paymentTerms').value = customer.paymentTerms || 30;
            document.getElementById('taxId').value = customer.taxId || '';
            
            // Load files
            const files = customerFiles[id] || [];
            document.getElementById('fileList').innerHTML = files.map(file => `
                <div class="file-item">
                    <span><i class="fas fa-file"></i> ${file.name}</span>
                    <button type="button" onclick="removeFile(${id}, '${file.name}')" style="background: #ff4444; border: none; color: white; padding: 2px 6px; border-radius: 3px; cursor: pointer;"></button>
                </div>
            `).join('');
            
            editingId = id;
            document.getElementById('customerModal').style.display = 'block';
        }

        function deleteCustomer(id) {
            if (confirm('Are you sure you want to delete this customer?')) {
                customers = customers.filter(c => c.id !== id);
                delete customerFiles[id];
                localStorage.setItem('customers', JSON.stringify(customers));
                localStorage.setItem('customerFiles', JSON.stringify(customerFiles));
                loadCustomers();
                loadAnalytics();
                showNotification('Customer deleted successfully', 'success');
            }
        }

        function viewCustomer(id) {
            const customer = customers.find(c => c.id === id);
            if (!customer) return;
            
            const files = customerFiles[id] || [];
            const balance = customer.balance || 0;
            const creditUsed = customer.creditUsed || 0;
            const creditLimit = customer.creditLimit || 0;
            const creditAvailable = creditLimit - creditUsed;
            
            document.getElementById('detailModalTitle').innerHTML = `
                <i class="fas fa-user"></i> ${customer.name}
            `;
            
            document.getElementById('customerDetailBody').innerHTML = `
                <div class="customer-detail-grid">
                    <div class="detail-item">
                        <div class="detail-label">
                            <i class="fas fa-envelope"></i> Email
                        </div>
                        <div class="detail-value">${customer.email || 'Not provided'}</div>
                    </div>
                    <div class="detail-item">
                        <div class="detail-label">
                            <i class="fas fa-phone"></i> Phone
                        </div>
                        <div class="detail-value">${customer.phone || 'Not provided'}</div>
                    </div>
                    <div class="detail-item">
                        <div class="detail-label">
                            <i class="fas fa-building"></i> Company
                        </div>
                        <div class="detail-value">${customer.company || 'Not provided'}</div>
                    </div>
                    <div class="detail-item">
                        <div class="detail-label">
                            <i class="fas fa-tag"></i> Status
                        </div>
                        <div class="detail-value">
                            <span class="customer-status status-${customer.status}">${customer.status.toUpperCase()}</span>
                        </div>
                    </div>
                    <div class="detail-item">
                        <div class="detail-label">
                            <i class="fas fa-dollar-sign"></i> Current Balance
                        </div>
                        <div class="detail-value large ${balance >= 0 ? 'positive' : 'negative'}">
                            $${Math.abs(balance).toFixed(2)} ${balance < 0 ? '(Overdue)' : ''}
                        </div>
                    </div>
                    <div class="detail-item">
                        <div class="detail-label">
                            <i class="fas fa-credit-card"></i> Credit Limit
                        </div>
                        <div class="detail-value large">$${creditLimit.toFixed(2)}</div>
                    </div>
                    <div class="detail-item">
                        <div class="detail-label">
                            <i class="fas fa-chart-line"></i> Credit Used
                        </div>
                        <div class="detail-value">$${creditUsed.toFixed(2)}</div>
                    </div>
                    <div class="detail-item">
                        <div class="detail-label">
                            <i class="fas fa-piggy-bank"></i> Credit Available
                        </div>
                        <div class="detail-value positive">$${creditAvailable.toFixed(2)}</div>
                    </div>
                    <div class="detail-item">
                        <div class="detail-label">
                            <i class="fas fa-calendar-alt"></i> Payment Terms
                        </div>
                        <div class="detail-value">${customer.paymentTerms || 30} days</div>
                    </div>
                    <div class="detail-item">
                        <div class="detail-label">
                            <i class="fas fa-id-card"></i> Tax ID
                        </div>
                        <div class="detail-value">${customer.taxId || 'Not provided'}</div>
                    </div>
                    <div class="detail-item" style="grid-column: 1 / -1;">
                        <div class="detail-label">
                            <i class="fas fa-map-marker-alt"></i> Address
                        </div>
                        <div class="detail-value">${customer.address || 'Not provided'}</div>
                    </div>
                    <div class="detail-item" style="grid-column: 1 / -1;">
                        <div class="detail-label">
                            <i class="fas fa-sticky-note"></i> Notes
                        </div>
                        <div class="detail-value">${customer.notes || 'No notes available'}</div>
                    </div>
                    <div class="detail-item">
                        <div class="detail-label">
                            <i class="fas fa-calendar-plus"></i> Created Date
                        </div>
                        <div class="detail-value">${new Date(customer.createdAt).toLocaleString()}</div>
                    </div>
                    <div class="detail-item">
                        <div class="detail-label">
                            <i class="fas fa-folder"></i> Files
                        </div>
                        <div class="detail-value">${files.length} file(s) uploaded</div>
                    </div>
                </div>
            `;
            
            document.getElementById('customerDetailModal').style.display = 'block';
        }

        function emailCustomer(id) {
            const customer = customers.find(c => c.id === id);
            if (!customer || !customer.email) {
                showNotification('Customer email not available', 'error');
                return;
            }
            
            document.getElementById('emailTo').value = customer.email;
            document.getElementById('emailSubject').value = `Follow-up from Majelani Accounting - ${customer.name}`;
            document.getElementById('emailMessage').value = `Dear ${customer.name},\n\nThank you for your continued business with us.\n\nBest regards,\nMajelani Accounting Team`;
            
            // Store customer ID for sending
            document.getElementById('emailModal').setAttribute('data-customer-id', id);
            document.getElementById('emailModal').style.display = 'block';
        }

        function viewFiles(id) {
            const customer = customers.find(c => c.id === id);
            const files = customerFiles[id] || [];
            
            if (files.length === 0) {
                document.getElementById('filesModalBody').innerHTML = `
                    <div class="empty-state">
                        <div class="empty-icon">
                            <i class="fas fa-folder-open"></i>
                        </div>
                        <h3>No files uploaded</h3>
                        <p>This customer hasn't uploaded any files yet</p>
                    </div>
                `;
            } else {
                document.getElementById('filesModalBody').innerHTML = `
                    <h4 style="color: #00ffff; margin-bottom: 20px; display: flex; align-items: center; gap: 10px;">
                        <i class="fas fa-user"></i> ${customer.name} - Files (${files.length})
                    </h4>
                    <div class="files-grid">
                        ${files.map(file => {
                            const extension = file.name.split('.').pop().toLowerCase();
                            let icon = 'fas fa-file';
                            
                            if (['pdf'].includes(extension)) icon = 'fas fa-file-pdf';
                            else if (['doc', 'docx'].includes(extension)) icon = 'fas fa-file-word';
                            else if (['xls', 'xlsx'].includes(extension)) icon = 'fas fa-file-excel';
                            else if (['jpg', 'jpeg', 'png', 'gif'].includes(extension)) icon = 'fas fa-file-image';
                            else if (['dwg', 'cad'].includes(extension)) icon = 'fas fa-drafting-compass';
                            
                            return `
                                <div class="file-card">
                                    <div class="file-icon">
                                        <i class="${icon}"></i>
                                    </div>
                                    <div class="file-name">${file.name}</div>
                                    <div class="file-size">${(file.size / 1024).toFixed(1)} KB</div>
                                </div>
                            `;
                        }).join('')}
                    </div>
                `;
            }
            
            document.getElementById('filesModal').style.display = 'block';
        }

        // File Management
        function handleFileUpload(input) {
            const files = Array.from(input.files);
            const fileList = document.getElementById('fileList');
            
            files.forEach(file => {
                const fileItem = document.createElement('div');
                fileItem.className = 'file-item';
                fileItem.innerHTML = `
                    <span><i class="fas fa-file"></i> ${file.name}</span>
                    <button type="button" onclick="this.parentElement.remove()" style="background: #ff4444; border: none; color: white; padding: 2px 6px; border-radius: 3px; cursor: pointer;"></button>
                `;
                fileList.appendChild(fileItem);
            });
        }

        function removeFile(customerId, fileName) {
            if (customerFiles[customerId]) {
                customerFiles[customerId] = customerFiles[customerId].filter(f => f.name !== fileName);
                localStorage.setItem('customerFiles', JSON.stringify(customerFiles));
                editCustomer(customerId); // Refresh the modal
            }
        }

        // Bulk Operations
        function toggleBulkMode() {
            bulkMode = !bulkMode;
            const btn = document.getElementById('bulkBtn');
            
            if (bulkMode) {
                btn.innerHTML = '<i class="fas fa-times"></i> Cancel Bulk';
                btn.style.background = 'linear-gradient(45deg, #ff4444, #cc0000)';
            } else {
                btn.innerHTML = '<i class="fas fa-check-square"></i> Bulk Actions';
                btn.style.background = 'linear-gradient(45deg, #ff6b6b, #ee5a52)';
                selectedCustomers.clear();
            }
            
            loadCustomers();
        }

        function toggleCustomerSelection(id) {
            if (selectedCustomers.has(id)) {
                selectedCustomers.delete(id);
            } else {
                selectedCustomers.add(id);
            }
            loadCustomers();
        }

        // Analytics
        function loadAnalytics() {
            const total = customers.length;
            const vip = customers.filter(c => c.status === 'vip').length;
            const totalRevenue = customers.reduce((sum, c) => sum + (c.balance || 0), 0);
            const overdue = customers.filter(c => (c.balance || 0) < 0).length;
            
            document.getElementById('totalCustomers').textContent = total;
            document.getElementById('vipCustomers').textContent = vip;
            document.getElementById('totalRevenue').textContent = '$' + totalRevenue.toFixed(2);
            document.getElementById('overdueCustomers').textContent = overdue;
            
            // Growth Chart
            const ctx = document.getElementById('growthChart');
            if (ctx) {
                const chart = new Chart(ctx, {
                    type: 'line',
                    data: {
                        labels: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun'],
                        datasets: [{
                            label: 'New Customers',
                            data: [12, 19, 8, 15, 22, 18],
                            borderColor: '#00ffff',
                            backgroundColor: 'rgba(0, 255, 255, 0.1)',
                            tension: 0.4
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                labels: { color: '#ffffff' }
                            }
                        },
                        scales: {
                            x: {
                                ticks: { color: '#ffffff' },
                                grid: { color: 'rgba(255, 255, 255, 0.1)' }
                            },
                            y: {
                                ticks: { color: '#ffffff' },
                                grid: { color: 'rgba(255, 255, 255, 0.1)' }
                            }
                        }
                    }
                });
            }
        }

        // Communications
        function loadCommunications() {
            const log = document.getElementById('communicationLog');
            
            if (communications.length === 0) {
                log.innerHTML = '<div class="empty-state"><div class="empty-icon"><i class="fas fa-comments"></i></div><h3>No communications yet</h3><p>Start communicating with your customers</p></div>';
                return;
            }
            
            log.innerHTML = communications.map(comm => `
                <div class="comm-item">
                    <div class="comm-header">
                        <div>
                            <span class="comm-type">${comm.type.toUpperCase()}</span>
                            <strong>${comm.customerName}</strong>
                        </div>
                        <div class="comm-date">${new Date(comm.date).toLocaleString()}</div>
                    </div>
                    <div><strong>${comm.subject}</strong></div>
                    <div>${comm.message}</div>
                </div>
            `).join('');
        }

        function openCommModal() {
            populateCustomerSelects();
            document.getElementById('commModal').style.display = 'block';
        }

        // Reminders
        function loadReminders() {
            const list = document.getElementById('remindersList');
            
            if (reminders.length === 0) {
                list.innerHTML = '<div class="empty-state"><div class="empty-icon"><i class="fas fa-bell"></i></div><h3>No reminders set</h3><p>Create reminders to stay on top of important tasks</p></div>';
                return;
            }
            
            const now = new Date();
            list.innerHTML = reminders.map(reminder => {
                const dueDate = new Date(reminder.date);
                const isOverdue = dueDate < now;
                
                return `
                    <div class="reminder-item" style="${isOverdue ? 'border-color: #ff4444;' : ''}">
                        <div class="reminder-header">
                            <div class="reminder-title">${reminder.title}</div>
                            <div class="reminder-due ${isOverdue ? 'style="color: #ff4444;"' : ''}">${dueDate.toLocaleString()}</div>
                        </div>
                        <div><strong>${reminder.customerName}</strong> - ${reminder.type}</div>
                        <div>${reminder.description}</div>
                        <button onclick="completeReminder(${reminder.id})" style="margin-top: 10px; background: #00ff88; border: none; padding: 5px 10px; border-radius: 5px; color: #000; cursor: pointer;">Complete</button>
                    </div>
                `;
            }).join('');
        }

        function openReminderModal() {
            populateCustomerSelects();
            document.getElementById('reminderModal').style.display = 'block';
        }

        function completeReminder(id) {
            reminders = reminders.filter(r => r.id !== id);
            localStorage.setItem('reminders', JSON.stringify(reminders));
            loadReminders();
            showNotification('Reminder completed', 'success');
        }

        function checkReminders() {
            const now = new Date();
            const dueReminders = reminders.filter(r => {
                const dueDate = new Date(r.date);
                const timeDiff = dueDate - now;
                return timeDiff > 0 && timeDiff < 24 * 60 * 60 * 1000; // Due within 24 hours
            });
            
            if (dueReminders.length > 0) {
                showNotification(`${dueReminders.length} reminder(s) due soon!`, 'info');
            }
        }

        // Custom Modal Functions
        function closeCustomModal(modalId) {
            document.getElementById(modalId).style.display = 'none';
        }

        function sendEmail() {
            const modalElement = document.getElementById('emailModal');
            const customerId = parseInt(modalElement.getAttribute('data-customer-id'));
            const customer = customers.find(c => c.id === customerId);
            
            const subject = document.getElementById('emailSubject').value.trim();
            const message = document.getElementById('emailMessage').value.trim();
            
            if (!subject || !message) {
                showNotification('Please fill in both subject and message', 'error');
                return;
            }
            
            // Log communication
            const comm = {
                id: Date.now(),
                customerId: customerId,
                customerName: customer.name,
                type: 'email',
                subject: subject,
                message: message,
                date: new Date().toISOString()
            };
            
            communications.push(comm);
            localStorage.setItem('communications', JSON.stringify(communications));
            
            closeCustomModal('emailModal');
            showNotification('Email sent and logged successfully', 'success');
            
            // Clear form
            document.getElementById('emailSubject').value = '';
            document.getElementById('emailMessage').value = '';
        }

        // Utility Functions
        function populateCustomerSelects() {
            const selects = ['commCustomer', 'reminderCustomer'];
            selects.forEach(selectId => {
                const select = document.getElementById(selectId);
                if (select) {
                    select.innerHTML = '<option value="">Select Customer</option>' + 
                        customers.map(c => `<option value="${c.id}">${c.name}</option>`).join('');
                }
            });
        }

        function closeModal(modalId) {
            document.getElementById(modalId).style.display = 'none';
        }

        function showNotification(message, type) {
            const notification = document.createElement('div');
            notification.className = `notification ${type}`;
            notification.textContent = message;
            document.body.appendChild(notification);
            
            setTimeout(() => notification.classList.add('show'), 100);
            setTimeout(() => {
                notification.classList.remove('show');
                setTimeout(() => document.body.removeChild(notification), 300);
            }, 3000);
        }

        // Import/Export
        function exportData() {
            const data = {
                customers: customers,
                communications: communications,
                reminders: reminders,
                customerFiles: customerFiles
            };
            
            const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'customers_export.json';
            a.click();
            URL.revokeObjectURL(url);
            
            showNotification('Data exported successfully', 'success');
        }

        function importData(input) {
            const file = input.files[0];
            if (!file) return;
            
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const data = JSON.parse(e.target.result);
                    
                    if (data.customers) customers = data.customers;
                    if (data.communications) communications = data.communications;
                    if (data.reminders) reminders = data.reminders;
                    if (data.customerFiles) customerFiles = data.customerFiles;
                    
                    localStorage.setItem('customers', JSON.stringify(customers));
                    localStorage.setItem('communications', JSON.stringify(communications));
                    localStorage.setItem('reminders', JSON.stringify(reminders));
                    localStorage.setItem('customerFiles', JSON.stringify(customerFiles));
                    
                    loadCustomers();
                    loadAnalytics();
                    loadCommunications();
                    loadReminders();
                    populateCustomerSelects();
                    
                    showNotification('Data imported successfully', 'success');
                } catch (error) {
                    showNotification('Error importing data', 'error');
                }
            };
            reader.readAsText(file);
        }

        // Form Submissions
        document.getElementById('customerForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const files = Array.from(document.getElementById('fileList').children).map(item => ({
                name: item.querySelector('span').textContent.replace(' ', ''),
                size: Math.floor(Math.random() * 10000) + 1000
            }));
            
            const customerData = {
                name: document.getElementById('customerName').value,
                email: document.getElementById('customerEmail').value,
                phone: document.getElementById('customerPhone').value,
                company: document.getElementById('customerCompany').value,
                address: document.getElementById('customerAddress').value,
                notes: document.getElementById('customerNotes').value,
                status: document.getElementById('customerStatus').value,
                creditLimit: parseFloat(document.getElementById('creditLimit').value) || 0,
                paymentTerms: parseInt(document.getElementById('paymentTerms').value) || 30,
                taxId: document.getElementById('taxId').value,
                balance: Math.random() * 10000 - 5000, // Random balance for demo
                creditUsed: Math.random() * 1000
            };
            
            if (editingId) {
                const index = customers.findIndex(c => c.id === editingId);
                customers[index] = { ...customers[index], ...customerData };
                customerFiles[editingId] = files;
            } else {
                customerData.id = Date.now();
                customerData.createdAt = new Date().toISOString();
                customers.push(customerData);
                customerFiles[customerData.id] = files;
            }
            
            localStorage.setItem('customers', JSON.stringify(customers));
            localStorage.setItem('customerFiles', JSON.stringify(customerFiles));
            loadCustomers();
            loadAnalytics();
            populateCustomerSelects();
            closeModal('customerModal');
            showNotification('Customer saved successfully', 'success');
        });

        document.getElementById('commForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const customerId = parseInt(document.getElementById('commCustomer').value);
            const customer = customers.find(c => c.id === customerId);
            
            const comm = {
                id: Date.now(),
                customerId: customerId,
                customerName: customer.name,
                type: document.getElementById('commType').value,
                subject: document.getElementById('commSubject').value,
                message: document.getElementById('commMessage').value,
                date: new Date().toISOString()
            };
            
            communications.push(comm);
            localStorage.setItem('communications', JSON.stringify(communications));
            loadCommunications();
            closeModal('commModal');
            showNotification('Communication logged successfully', 'success');
        });

        document.getElementById('reminderForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const customerId = parseInt(document.getElementById('reminderCustomer').value);
            const customer = customers.find(c => c.id === customerId);
            
            const reminder = {
                id: Date.now(),
                customerId: customerId,
                customerName: customer.name,
                type: document.getElementById('reminderType').value,
                title: document.getElementById('reminderTitle').value,
                description: document.getElementById('reminderDescription').value,
                date: document.getElementById('reminderDate').value
            };
            
            reminders.push(reminder);
            localStorage.setItem('reminders', JSON.stringify(reminders));
            loadReminders();
            closeModal('reminderModal');
            showNotification('Reminder created successfully', 'success');
        });

        // Search and Filter
        document.getElementById('searchBox').addEventListener('input', filterCustomers);
        document.getElementById('statusFilter').addEventListener('change', filterCustomers);
        document.getElementById('segmentFilter').addEventListener('change', filterCustomers);

        function filterCustomers() {
            const searchTerm = document.getElementById('searchBox').value.toLowerCase();
            const statusFilter = document.getElementById('statusFilter').value;
            const segmentFilter = document.getElementById('segmentFilter').value;
            
            let filteredCustomers = customers.filter(customer => {
                const matchesSearch = customer.name.toLowerCase().includes(searchTerm) ||
                    (customer.email && customer.email.toLowerCase().includes(searchTerm)) ||
                    (customer.company && customer.company.toLowerCase().includes(searchTerm));
                
                const matchesStatus = !statusFilter || customer.status === statusFilter;
                
                let matchesSegment = true;
                if (segmentFilter === 'high-value') {
                    matchesSegment = (customer.balance || 0) > 5000;
                } else if (segmentFilter === 'new') {
                    const createdDate = new Date(customer.createdAt);
                    const thirtyDaysAgo = new Date();
                    thirtyDaysAgo.setDate(thirtyDaysAgo.getDate() - 30);
                    matchesSegment = createdDate > thirtyDaysAgo;
                }
                
                return matchesSearch && matchesStatus && matchesSegment;
            });
            
            const grid = document.getElementById('customersGrid');
            if (filteredCustomers.length === 0) {
                grid.innerHTML = '<div style="grid-column: 1/-1; text-align: center; color: #666; padding: 40px;">No customers match your criteria</div>';
            } else {
                // Re-render with filtered customers
                const originalCustomers = customers;
                customers = filteredCustomers;
                loadCustomers();
                customers = originalCustomers;
            }
        }
    </script>
</body>
</html>